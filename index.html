<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales System Pro - Sistema Profissional de Vendas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* === ESTILOS GLOBAIS === */
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .hidden {
            display: none !important;
        }

        /* === LANDING PAGE === */
        .landing-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-brand h1 {
            color: white;
            font-size: 1.5rem;
        }

        .badge {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .hero {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 80px);
            padding: 2rem;
        }

        .hero-content {
            text-align: center;
            color: white;
            max-width: 800px;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 3rem;
            opacity: 0.9;
        }

        .hero-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .feature {
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(10px);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .hero-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* === BOT√ïES === */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary);
        }

        .btn-full {
            width: 100%;
            justify-content: center;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* === MODAL === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        /* === FORMUL√ÅRIOS === */
        .auth-form {
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .auth-switch {
            text-align: center;
            margin-top: 1.5rem;
            color: var(--text-light);
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
        }

        /* === DASHBOARD === */
        .app-header {
            background: white;
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-brand h1 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .user-plan {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .user-plan.free {
            background: #dcfce7;
            color: #166534;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            text-align: right;
        }

        .company-name {
            display: block;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .user-name {
            display: block;
            font-weight: 600;
        }

        .app-main {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 80px);
        }

        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid var(--border);
            padding: 2rem 0;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
        }

        .menu-item {
            padding: 1rem 2rem;
            text-decoration: none;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .menu-item:hover {
            background: var(--background);
            color: var(--primary);
        }

        .menu-item.active {
            background: var(--background);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        .page-content {
            flex: 1;
            padding: 2rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .page-header h2 {
            font-size: 1.875rem;
            font-weight: 700;
        }

        .page-actions {
            display: flex;
            gap: 1rem;
        }

        .select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            background: white;
        }

        /* === CARDS DE RESUMO === */
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .card-icon.sales { background: #dbeafe; color: #1d4ed8; }
        .card-icon.returns { background: #fef3c7; color: #d97706; }
        .card-icon.net { background: #dcfce7; color: #166534; }
        .card-icon.goal { background: #f3e8ff; color: #7c3aed; }

        .card-content h3 {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
        }

        .card-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* === GR√ÅFICOS === */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow);
        }

        .chart-container h3 {
            margin-bottom: 1rem;
            font-size: 1.125rem;
        }

        .chart-container canvas {
            max-height: 300px;
        }

        /* === TABELAS === */
        .table-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 0.5rem;
        }

        .sales-table {
            width: 100%;
            border-collapse: collapse;
        }

        .sales-table th,
        .sales-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .sales-table th {
            background: var(--background);
            font-weight: 600;
            color: var(--text-light);
            position: sticky;
            top: 0;
            cursor: pointer;
        }

        .sales-table th:hover {
            background: var(--border);
        }

        .return-row {
            background: #fef2f2 !important;
        }

        .daily-total-row {
            background: var(--background) !important;
            font-weight: 600;
        }

        /* === ALERTAS === */
        .alert {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        /* === RESPONSIVO === */
        @media (max-width: 1024px) {
            .app-main {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 1rem 0;
            }
            
            .sidebar-menu {
                flex-direction: row;
                overflow-x: auto;
                padding: 0 1rem;
            }
            
            .menu-item {
                padding: 0.75rem 1rem;
                border-left: none;
                border-bottom: 3px solid transparent;
                white-space: nowrap;
            }
            
            .menu-item.active {
                border-left: none;
                border-bottom-color: var(--primary);
            }
        }

        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5rem;
            }
            
            .hero-features {
                grid-template-columns: 1fr;
            }
            
            .hero-actions {
                flex-direction: column;
            }
            
            .navbar {
                padding: 1rem;
            }
            
            .header-content {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .page-content {
                padding: 1rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- === LANDING PAGE === -->
    <div id="landing-page" class="landing-container">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>Sales System Pro</h1>
                <span class="badge">FREE</span>
            </div>
            <div class="nav-actions">
                <button onclick="showLogin()" class="btn btn-outline">Entrar</button>
                <button onclick="showRegister()" class="btn btn-primary">Cadastrar</button>
            </div>
        </nav>

        <main class="hero">
            <div class="hero-content">
                <h1>Gest√£o de Vendas Profissional</h1>
                <p class="hero-subtitle">Sistema completo para controle de vendas, metas e relat√≥rios. 100% gratuito e online.</p>
                
                <div class="hero-features">
                    <div class="feature">
                        <span class="feature-icon">üìä</span>
                        <h3>Relat√≥rios Avan√ßados</h3>
                        <p>Gr√°ficos e m√©tricas em tempo real</p>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">üéØ</span>
                        <h3>Controle de Metas</h3>
                        <p>Acompanhe performance da equipe</p>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">‚òÅÔ∏è</span>
                        <h3>Dados na Nuvem</h3>
                        <p>Acesse de qualquer dispositivo</p>
                    </div>
                </div>

                <div class="hero-actions">
                    <button onclick="showRegister()" class="btn btn-primary btn-large">
                        Come√ßar Agora - Gr√°tis
                    </button>
                    <button onclick="showLogin()" class="btn btn-outline btn-large">
                        J√° tenho conta
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- === MODAL LOGIN === -->
    <div id="login-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="hideModals()">√ó</button>
            <h2>Entrar no Sistema</h2>
            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Entrar</button>
            </form>
            <p class="auth-switch">
                N√£o tem conta? <a href="#" onclick="showRegister()">Cadastre-se</a>
            </p>
        </div>
    </div>

    <!-- === MODAL REGISTRO === -->
    <div id="register-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" onclick="hideModals()">√ó</button>
            <h2>Criar Conta</h2>
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label>Nome da Empresa</label>
                    <input type="text" id="register-company" required>
                </div>
                <div class="form-group">
                    <label>Seu Nome</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="register-password" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary btn-full">Criar Conta</button>
            </form>
            <p class="auth-switch">
                J√° tem conta? <a href="#" onclick="showLogin()">Fa√ßa login</a>
            </p>
        </div>
    </div>

    <!-- === DASHBOARD PRINCIPAL === -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-brand">
                    <h1>Sales System Pro</h1>
                    <span class="user-plan free">FREE</span>
                </div>
                
                <div class="header-actions">
                    <div class="user-info">
                        <span id="company-name" class="company-name"></span>
                        <span id="user-name" class="user-name"></span>
                    </div>
                    <button onclick="logout()" class="btn btn-outline btn-sm">
                        <span>üö™</span> Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Sidebar -->
            <nav class="sidebar">
                <div class="sidebar-menu">
                    <a class="menu-item active" data-page="dashboard" onclick="navigateTo('dashboard')">
                        <span>üìä</span> Dashboard
                    </a>
                    <a class="menu-item" data-page="sales" onclick="navigateTo('sales')">
                        <span>üí∞</span> Vendas
                    </a>
                    <a class="menu-item" data-page="goals" onclick="navigateTo('goals')">
                        <span>üéØ</span> Metas
                    </a>
                    <a class="menu-item" data-page="reports" onclick="navigateTo('reports')">
                        <span>üìà</span> Relat√≥rios
                    </a>
                </div>
            </nav>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="page-header">
                        <h2>Dashboard</h2>
                        <div class="page-actions">
                            <select id="month-select" class="select">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                            <select id="year-select" class="select">
                                <!-- Years will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="card-icon sales">üí∞</div>
                            <div class="card-content">
                                <h3>Total Vendido</h3>
                                <p id="total-sold" class="card-value">R$ 0,00</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon returns">üîÑ</div>
                            <div class="card-content">
                                <h3>Devolu√ß√µes</h3>
                                <p id="total-returns" class="card-value">R$ 0,00</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon net">üí≤</div>
                            <div class="card-content">
                                <h3>Valor L√≠quido</h3>
                                <p id="net-amount" class="card-value">R$ 0,00</p>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="card-icon goal">üéØ</div>
                            <div class="card-content">
                                <h3>Meta Mensal</h3>
                                <p id="monthly-goal-display" class="card-value">R$ 0,00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>Progresso da Meta</h3>
                            <canvas id="progress-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>Vendas Di√°rias</h3>
                            <canvas id="sales-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Sales Page -->
                <div id="sales-page" class="page">
                    <div class="page-header">
                        <h2>Gest√£o de Vendas</h2>
                        <div class="page-actions">
                            <select id="sales-month-select" class="select">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                            <select id="sales-year-select" class="select">
                                <!-- Years populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <!-- Sales Form -->
                    <div class="chart-container" style="margin-bottom: 2rem;">
                        <h3>Adicionar Venda/Devolu√ß√£o</h3>
                        <form id="sale-form" style="margin-top: 1rem;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                <div class="form-group">
                                    <label for="sale-date">Data</label>
                                    <input type="date" id="sale-date" required>
                                </div>
                                <div class="form-group">
                                    <label for="sale-value">Valor (R$)</label>
                                    <input type="number" id="sale-value" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="sale-type">Tipo</label>
                                    <select id="sale-type">
                                        <option value="sale">Venda</option>
                                        <option value="return">Devolu√ß√£o</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="sale-description">Descri√ß√£o (opcional)</label>
                                <input type="text" id="sale-description" placeholder="Descri√ß√£o da venda...">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <span>‚ûï</span> Adicionar Venda
                            </button>
                        </form>
                    </div>

                    <!-- Sales Table -->
                    <div class="chart-container">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Vendas do M√™s</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <div style="display: flex; gap: 0.25rem;">
                                    <button id="filter-all" class="btn btn-sm active">Todos</button>
                                    <button id="filter-sales" class="btn btn-sm">Vendas</button>
                                    <button id="filter-returns" class="btn btn-sm">Devolu√ß√µes</button>
                                </div>
                                <span style="font-size: 0.875rem; color: var(--text-light);">
                                    <span id="sales-count">0</span> registros
                                </span>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="sales-table">
                                <thead>
                                    <tr>
                                        <th data-sort="date">Data ‚Üï</th>
                                        <th data-sort="value">Valor ‚Üï</th>
                                        <th>Tipo</th>
                                        <th>Descri√ß√£o</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="sales-table-body">
                                    <!-- Sales will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Goals Page -->
                <div id="goals-page" class="page">
                    <div class="page-header">
                        <h2>Metas Mensais</h2>
                        <div class="page-actions">
                            <select id="goals-month-select" class="select">
                                <option value="0">Janeiro</option>
                                <option value="1">Fevereiro</option>
                                <option value="2">Mar√ßo</option>
                                <option value="3">Abril</option>
                                <option value="4">Maio</option>
                                <option value="5">Junho</option>
                                <option value="6">Julho</option>
                                <option value="7">Agosto</option>
                                <option value="8">Setembro</option>
                                <option value="9">Outubro</option>
                                <option value="10">Novembro</option>
                                <option value="11">Dezembro</option>
                            </select>
                            <select id="goals-year-select" class="select">
                                <!-- Years populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>Definir Meta Mensal</h3>
                            <form id="goal-form" style="margin-top: 1rem;">
                                <div class="form-group">
                                    <label for="monthly-goal-input">Meta do M√™s (R$)</label>
                                    <input type="number" id="monthly-goal-input" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="workdays-input">Dias √öteis</label>
                                    <input type="number" id="workdays-input" min="1" max="31" value="22" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-full">
                                    <span>üíæ</span> Salvar Meta
                                </button>
                            </form>
                        </div>

                        <div class="chart-container">
                            <h3>Anota√ß√µes do M√™s</h3>
                            <form id="notes-form" style="margin-top: 1rem;">
                                <div class="form-group">
                                    <textarea id="monthly-notes" rows="6" placeholder="Adicione suas anota√ß√µes aqui..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary btn-full">
                                    <span>üìù</span> Salvar Anota√ß√µes
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-page" class="page">
                    <div class="page-header">
                        <h2>Relat√≥rios</h2>
                        <div class="page-actions">
                            <select id="reports-year-select" class="select">
                                <!-- Years populated by JavaScript -->
                            </select>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-container">
                            <h3>Relat√≥rio Anual</h3>
                            <canvas id="annual-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3>A√ß√µes</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
                                <button onclick="printReport()" class="btn btn-primary">
                                    <span>üñ®Ô∏è</span> Imprimir Relat√≥rio
                                </button>
                                <button onclick="exportData()" class="btn btn-outline">
                                    <span>üì•</span> Exportar Dados
                                </button>
                                <button onclick="importData()" class="btn btn-outline">
                                    <span>üì§</span> Importar Dados
                                </button>
                                <button onclick="showStats()" class="btn btn-outline">
                                    <span>üìä</span> Estat√≠sticas
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- === SISTEMA DE BANCO DE DADOS === -->
    <script>
        // Database System
        class Database {
            constructor() {
                this.tables = {
                    'sales': 'sales_data',
                    'monthly_goals': 'monthly_goals_data', 
                    'monthly_notes': 'monthly_notes_data',
                    'users': 'users_data',
                    'companies': 'companies_data'
                };
                this.init();
            }

            init() {
                Object.values(this.tables).forEach(table => {
                    if (!localStorage.getItem(table)) {
                        localStorage.setItem(table, JSON.stringify([]));
                    }
                });
                
                // Create demo admin user if not exists
                this.createDemoUser();
            }

            createDemoUser() {
                const users = this.getTable('users');
                if (users.find(u => u.email === 'admin@salesystem.com')) return;

                const companyId = this.generateId();
                const companies = this.getTable('companies');
                companies.push({
                    id: companyId,
                    name: 'Empresa Demo',
                    email: 'admin@salesystem.com',
                    plan: 'free',
                    created_at: new Date().toISOString()
                });
                this.setTable('companies', companies);

                const userId = this.generateId();
                users.push({
                    id: userId,
                    company_id: companyId,
                    name: 'Administrador',
                    email: 'admin@salesystem.com',
                    password_hash: btoa('admin123'),
                    role: 'admin',
                    is_active: true,
                    created_at: new Date().toISOString()
                });
                this.setTable('users', users);
            }

            // Sales operations
            async getSales(filters = {}) {
                const sales = this.getTable('sales');
                let filtered = sales.filter(sale => sale.company_id === this.getCompanyId());

                if (filters.year !== undefined) {
                    filtered = filtered.filter(sale => {
                        const saleYear = new Date(sale.sale_date).getFullYear();
                        return saleYear === parseInt(filters.year);
                    });
                }

                if (filters.month !== undefined) {
                    filtered = filtered.filter(sale => {
                        const saleMonth = new Date(sale.sale_date).getMonth();
                        return saleMonth === parseInt(filters.month);
                    });
                }

                if (filters.type && filters.type !== 'all') {
                    filtered = filtered.filter(sale => sale.sale_type === filters.type);
                }

                return filtered;
            }

            async addSale(saleData) {
                const sales = this.getTable('sales');
                const newSale = {
                    id: this.generateId(),
                    company_id: this.getCompanyId(),
                    user_id: this.getUserId(),
                    ...saleData,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };
                
                sales.push(newSale);
                this.setTable('sales', sales);
                return newSale;
            }

            async deleteSale(saleId) {
                const sales = this.getTable('sales');
                const filtered = sales.filter(s => !(s.id === saleId && s.company_id === this.getCompanyId()));
                this.setTable('sales', filtered);
                return true;
            }

            // Monthly Goals operations
            async getMonthlyGoal(year, month) {
                const goals = this.getTable('monthly_goals');
                return goals.find(g => 
                    g.company_id === this.getCompanyId() && 
                    g.year === year && 
                    g.month === month
                );
            }

            async saveMonthlyGoal(year, month, goalData) {
                const goals = this.getTable('monthly_goals');
                const existingIndex = goals.findIndex(g => 
                    g.company_id === this.getCompanyId() && 
                    g.year === year && 
                    g.month === month
                );

                const goal = {
                    id: this.generateId(),
                    company_id: this.getCompanyId(),
                    year,
                    month,
                    ...goalData,
                    created_at: new Date().toISOString()
                };

                if (existingIndex !== -1) {
                    goals[existingIndex] = goal;
                } else {
                    goals.push(goal);
                }

                this.setTable('monthly_goals', goals);
                return goal;
            }

            // Monthly Notes operations
            async getMonthlyNotes(year, month) {
                const notes = this.getTable('monthly_notes');
                return notes.find(n => 
                    n.company_id === this.getCompanyId() && 
                    n.year === year && 
                    n.month === month
                );
            }

            async saveMonthlyNotes(year, month, notesText) {
                const notes = this.getTable('monthly_notes');
                const existingIndex = notes.findIndex(n => 
                    n.company_id === this.getCompanyId() && 
                    n.year === year && 
                    n.month === month
                );

                const note = {
                    id: this.generateId(),
                    company_id: this.getCompanyId(),
                    year,
                    month,
                    notes: notesText,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString()
                };

                if (existingIndex !== -1) {
                    notes[existingIndex] = note;
                } else {
                    notes.push(note);
                }

                this.setTable('monthly_notes', notes);
                return note;
            }

            // Utility methods
            getTable(tableName) {
                const key = this.tables[tableName];
                return JSON.parse(localStorage.getItem(key) || '[]');
            }

            setTable(tableName, data) {
                const key = this.tables[tableName];
                localStorage.setItem(key, JSON.stringify(data));
            }

            getCompanyId() {
                const company = JSON.parse(localStorage.getItem('currentCompany') || '{}');
                return company.id;
            }

            getUserId() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                return user.id;
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            // Statistics
            async getMonthlySummary(year, month) {
                const sales = await this.getSales({ year, month });
                
                const totalSold = sales
                    .filter(sale => sale.sale_type === 'sale')
                    .reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
                    
                const totalReturns = sales
                    .filter(sale => sale.sale_type === 'return')
                    .reduce((sum, sale) => sum + parseFloat(sale.amount), 0);
                    
                const netAmount = totalSold - totalReturns;
                
                const goal = await this.getMonthlyGoal(year, month);
                const monthlyGoal = goal ? parseFloat(goal.goal_amount) : 0;
                const workdays = goal ? goal.workdays : 22;

                const progressPercentage = monthlyGoal > 0 ? Math.min(100, (netAmount / monthlyGoal) * 100) : 0;
                const dailyGoal = workdays > 0 ? monthlyGoal / workdays : 0;
                const averageNeeded = workdays > 0 ? monthlyGoal / workdays : 0;

                return {
                    totalSales: totalSold,
                    totalReturns: totalReturns,
                    netAmount: netAmount,
                    salesCount: sales.filter(s => s.sale_type === 'sale').length,
                    returnsCount: sales.filter(s => s.sale_type === 'return').length,
                    monthlyGoal,
                    workdays,
                    dailyGoal,
                    averageNeeded,
                    progressPercentage
                };
            }

            async getAnnualReport(year) {
                const monthlyData = [];
                
                for (let month = 0; month < 12; month++) {
                    const summary = await this.getMonthlySummary(year, month);
                    monthlyData.push({
                        month,
                        ...summary
                    });
                }

                const annualTotal = monthlyData.reduce((sum, month) => sum + month.netAmount, 0);
                const annualSales = monthlyData.reduce((sum, month) => sum + month.totalSales, 0);
                const annualReturns = monthlyData.reduce((sum, month) => sum + month.totalReturns, 0);

                return {
                    year,
                    monthlyData,
                    annualTotal,
                    annualSales,
                    annualReturns,
                    monthsWithData: monthlyData.filter(month => month.salesCount > 0 || month.returnsCount > 0).length
                };
            }

            // Backup and restore
            async exportData() {
                const data = {};
                Object.keys(this.tables).forEach(table => {
                    data[table] = this.getTable(table);
                });
                return data;
            }

            async importData(data) {
                Object.keys(data).forEach(table => {
                    if (this.tables[table]) {
                        this.setTable(table, data[table]);
                    }
                });
                return true;
            }
        }

        // Global database instance
        const db = new Database();
    </script>

    <!-- === SISTEMA DE AUTENTICA√á√ÉO === -->
    <script>
        // Authentication System
        class AuthSystem {
            constructor() {
                this.currentUser = null;
                this.currentCompany = null;
                this.init();
            }

            init() {
                this.loadUserData();
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Login form
                const loginForm = document.getElementById('login-form');
                if (loginForm) {
                    loginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleLogin();
                    });
                }

                // Register form
                const registerForm = document.getElementById('register-form');
                if (registerForm) {
                    registerForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.handleRegister();
                    });
                }
            }

            handleLogin() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                if (!email || !password) {
                    this.showAlert('Preencha todos os campos', 'error');
                    return;
                }

                const user = this.authenticateUser(email, password);
                
                if (user) {
                    this.login(user);
                    this.showAlert('Login realizado com sucesso!', 'success');
                    
                    setTimeout(() => {
                        showMainApp();
                    }, 1000);
                } else {
                    this.showAlert('Email ou senha incorretos', 'error');
                }
            }

            handleRegister() {
                const company = document.getElementById('register-company').value;
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;

                if (!company || !name || !email || !password) {
                    this.showAlert('Preencha todos os campos', 'error');
                    return;
                }

                if (password.length < 6) {
                    this.showAlert('A senha deve ter pelo menos 6 caracteres', 'error');
                    return;
                }

                const success = this.registerUser(company, name, email, password);
                
                if (success) {
                    this.showAlert('Conta criada com sucesso!', 'success');
                    
                    setTimeout(() => {
                        const user = this.authenticateUser(email, password);
                        if (user) {
                            this.login(user);
                            showMainApp();
                        }
                    }, 1000);
                } else {
                    this.showAlert('Email j√° cadastrado', 'error');
                }
            }

            registerUser(companyName, userName, email, password) {
                const users = db.getTable('users');
                
                if (users.find(u => u.email === email)) {
                    return false;
                }

                const companyId = db.generateId();
                const companies = db.getTable('companies');
                companies.push({
                    id: companyId,
                    name: companyName,
                    email: email,
                    plan: 'free',
                    created_at: new Date().toISOString()
                });
                db.setTable('companies', companies);

                const userId = db.generateId();
                const user = {
                    id: userId,
                    company_id: companyId,
                    name: userName,
                    email: email,
                    password_hash: btoa(password),
                    role: 'admin',
                    is_active: true,
                    created_at: new Date().toISOString()
                };
                
                users.push(user);
                db.setTable('users', users);

                return true;
            }

            authenticateUser(email, password) {
                const users = db.getTable('users');
                const companies = db.getTable('companies');
                
                const user = users.find(u => 
                    u.email === email && 
                    u.password_hash === btoa(password) &&
                    u.is_active
                );

                if (user) {
                    const company = companies.find(c => c.id === user.company_id);
                    return {
                        ...user,
                        company_name: company?.name || 'Empresa',
                        company_plan: company?.plan || 'free'
                    };
                }

                return null;
            }

            login(user) {
                this.currentUser = user;
                this.currentCompany = {
                    id: user.company_id,
                    name: user.company_name,
                    plan: user.company_plan
                };
                
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('currentCompany', JSON.stringify(this.currentCompany));
            }

            logout() {
                this.currentUser = null;
                this.currentCompany = null;
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentCompany');
                window.location.reload();
            }

            loadUserData() {
                const userData = localStorage.getItem('currentUser');
                const companyData = localStorage.getItem('currentCompany');
                
                if (userData && companyData) {
                    this.currentUser = JSON.parse(userData);
                    this.currentCompany = JSON.parse(companyData);
                }
            }

            isLoggedIn() {
                return this.currentUser !== null;
            }

            showAlert(message, type = 'info') {
                const existingAlert = document.querySelector('.auth-alert');
                if (existingAlert) {
                    existingAlert.remove();
                }

                const alert = document.createElement('div');
                alert.className = `auth-alert ${type}`;
                alert.textContent = message;
                alert.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    padding: 12px 20px;
                    border-radius: 5px;
                    color: white;
                    font-weight: 500;
                    ${type === 'success' ? 'background: #10b981;' : ''}
                    ${type === 'error' ? 'background: #ef4444;' : ''}
                    ${type === 'info' ? 'background: #3b82f6;' : ''}
                `;

                document.body.appendChild(alert);

                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }
        }

        // Global auth instance
        const auth = new AuthSystem();
    </script>

    <!-- === SISTEMA PRINCIPAL DA APLICA√á√ÉO === -->
    <script>
        // Main Application
        class SalesSystemApp {
            constructor() {
                this.currentYear = new Date().getFullYear();
                this.currentMonth = new Date().getMonth();
                this.currentFilter = 'all';
                this.currentSort = { field: 'date', direction: 'desc' };
                this.salesChart = null;
                this.progressChart = null;
                this.annualChart = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeSelects();
                this.checkAuthentication();
            }

            setupEventListeners() {
                // Sales form
                const saleForm = document.getElementById('sale-form');
                if (saleForm) {
                    saleForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.addSale();
                    });
                }

                // Goal form
                const goalForm = document.getElementById('goal-form');
                if (goalForm) {
                    goalForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveMonthlyGoal();
                    });
                }

                // Notes form
                const notesForm = document.getElementById('notes-form');
                if (notesForm) {
                    notesForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.saveMonthlyNotes();
                    });
                }

                // Filter buttons
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'filter-all' || e.target.closest('#filter-all')) {
                        this.setFilter('all');
                    } else if (e.target.id === 'filter-sales' || e.target.closest('#filter-sales')) {
                        this.setFilter('sales');
                    } else if (e.target.id === 'filter-returns' || e.target.closest('#filter-returns')) {
                        this.setFilter('returns');
                    }
                    
                    if (e.target.closest('th[data-sort]')) {
                        const field = e.target.closest('th[data-sort]').getAttribute('data-sort');
                        this.sortSales(field);
                    }
                    
                    if (e.target.closest('.edit-sale')) {
                        const index = e.target.closest('.edit-sale').getAttribute('data-index');
                        this.editSale(parseInt(index));
                    }
                    
                    if (e.target.closest('.delete-sale')) {
                        const index = e.target.closest('.delete-sale').getAttribute('data-index');
                        this.deleteSale(parseInt(index));
                    }
                });
            }

            initializeSelects() {
                // Initialize year selects
                const yearSelects = ['year-select', 'sales-year-select', 'goals-year-select', 'reports-year-select'];
                yearSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '';
                        for (let i = this.currentYear - 5; i <= this.currentYear + 5; i++) {
                            const option = document.createElement('option');
                            option.value = i;
                            option.textContent = i;
                            if (i === this.currentYear) option.selected = true;
                            select.appendChild(option);
                        }
                        select.addEventListener('change', (e) => {
                            this.currentYear = parseInt(e.target.value);
                            this.updateDisplay();
                        });
                    }
                });

                // Initialize month selects
                const monthSelects = ['month-select', 'sales-month-select', 'goals-month-select'];
                monthSelects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.value = this.currentMonth;
                        select.addEventListener('change', (e) => {
                            this.currentMonth = parseInt(e.target.value);
                            this.updateDisplay();
                        });
                    }
                });

                this.setCurrentDate();
            }

            checkAuthentication() {
                if (auth.isLoggedIn()) {
                    showMainApp();
                }
            }

            async addSale() {
                const date = document.getElementById('sale-date').value;
                const value = parseFloat(document.getElementById('sale-value').value);
                const type = document.getElementById('sale-type').value;
                const description = document.getElementById('sale-description').value;

                if (!date || isNaN(value) || value <= 0) {
                    this.showAlert('Preencha todos os campos obrigat√≥rios com valores v√°lidos.', 'error');
                    return;
                }

                try {
                    await db.addSale({
                        sale_date: date,
                        amount: value,
                        sale_type: type,
                        description: description
                    });

                    this.showAlert(
                        type === 'sale' ? 'Venda registrada com sucesso!' : 'Devolu√ß√£o registrada com sucesso!',
                        'success'
                    );

                    document.getElementById('sale-form').reset();
                    this.setCurrentDate();
                    this.updateDisplay();

                } catch (error) {
                    this.showAlert('Erro ao adicionar venda: ' + error.message, 'error');
                }
            }

            async editSale(index) {
                const sales = await db.getSales({
                    year: this.currentYear,
                    month: this.currentMonth
                });

                const sale = sales[index];
                
                document.getElementById('sale-date').value = sale.sale_date;
                document.getElementById('sale-value').value = sale.amount;
                document.getElementById('sale-type').value = sale.sale_type;
                document.getElementById('sale-description').value = sale.description || '';

                await db.deleteSale(sale.id);
                
                this.showAlert('Venda carregada para edi√ß√£o. Fa√ßa as altera√ß√µes e clique em Adicionar.', 'info');
                this.updateDisplay();
            }

            async deleteSale(index) {
                if (!confirm('Tem certeza que deseja excluir este registro?')) {
                    return;
                }

                const sales = await db.getSales({
                    year: this.currentYear,
                    month: this.currentMonth
                });

                const sale = sales[index];
                
                try {
                    await db.deleteSale(sale.id);
                    this.showAlert('Registro exclu√≠do com sucesso!', 'success');
                    this.updateDisplay();
                } catch (error) {
                    this.showAlert('Erro ao excluir registro: ' + error.message, 'error');
                }
            }

            setFilter(filter) {
                this.currentFilter = filter;
                
                // Update button states
                document.getElementById('filter-all').classList.toggle('active', filter === 'all');
                document.getElementById('filter-sales').classList.toggle('active', filter === 'sales');
                document.getElementById('filter-returns').classList.toggle('active', filter === 'returns');
                
                this.updateSalesTable();
            }

            sortSales(field) {
                if (this.currentSort.field === field) {
                    this.currentSort.direction = this.currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.currentSort.field = field;
                    this.currentSort.direction = 'asc';
                }
                
                this.updateSalesTable();
            }

            async updateDisplay() {
                await this.updateSalesTable();
                await this.updateMonthlySummary();
                await this.updateCharts();
                await this.loadGoalData();
                await this.loadNotesData();
            }

            async updateSalesTable() {
                const tbody = document.getElementById('sales-table-body');
                if (!tbody) return;

                tbody.innerHTML = '';

                let sales = await db.getSales({
                    year: this.currentYear,
                    month: this.currentMonth
                });

                // Apply filter
                if (this.currentFilter === 'sales') {
                    sales = sales.filter(sale => sale.sale_type === 'sale');
                } else if (this.currentFilter === 'returns') {
                    sales = sales.filter(sale => sale.sale_type === 'return');
                }

                // Apply sorting
                sales.sort((a, b) => {
                    let aValue, bValue;
                    
                    if (this.currentSort.field === 'date') {
                        aValue = a.sale_date;
                        bValue = b.sale_date;
                    } else {
                        aValue = a.amount;
                        bValue = b.amount;
                    }
                    
                    if (this.currentSort.direction === 'asc') {
                        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                    } else {
                        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                    }
                });

                if (sales.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-light);">
                                Nenhuma venda encontrada para o per√≠odo selecionado
                            </td>
                        </tr>
                    `;
                    return;
                }

                sales.forEach((sale, index) => {
                    const saleDate = new Date(sale.sale_date);
                    const formattedDate = saleDate.toLocaleDateString('pt-BR');

                    const row = document.createElement('tr');
                    if (sale.sale_type === 'return') {
                        row.classList.add('return-row');
                    }
                    
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td style="${sale.sale_type === 'return' ? 'color: var(--danger);' : 'color: var(--success);'}">
                            ${sale.sale_type === 'return' ? '-' : ''}R$ ${this.formatCurrency(sale.amount)}
                        </td>
                        <td>
                            <span style="
                                display: inline-block;
                                padding: 0.25rem 0.5rem;
                                border-radius: 0.25rem;
                                font-size: 0.75rem;
                                font-weight: 600;
                                ${sale.sale_type === 'return' ? 
                                    'background: #fef2f2; color: #dc2626;' : 
                                    'background: #f0fdf4; color: #16a34a;'
                                }
                            ">
                                ${sale.sale_type === 'return' ? 'Devolu√ß√£o' : 'Venda'}
                            </span>
                        </td>
                        <td>${sale.description || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-outline edit-sale" data-index="${index}">
                                <span>‚úèÔ∏è</span> Editar
                            </button>
                            <button class="btn btn-sm btn-danger delete-sale" data-index="${index}">
                                <span>üóëÔ∏è</span> Excluir
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });

                // Update sales count
                const salesCount = document.getElementById('sales-count');
                if (salesCount) {
                    salesCount.textContent = sales.length;
                }
            }

            async updateMonthlySummary() {
                const summary = await db.getMonthlySummary(this.currentYear, this.currentMonth);
                
                // Update summary cards
                this.updateElement('total-sold', summary.totalSales);
                this.updateElement('total-returns', summary.totalReturns);
                this.updateElement('net-amount', summary.netAmount);
                this.updateElement('monthly-goal-display', summary.monthlyGoal);
            }

            async updateCharts() {
                await this.updateProgressChart();
                await this.updateSalesChart();
            }

            async updateProgressChart() {
                const ctx = document.getElementById('progress-chart');
                if (!ctx) return;

                const summary = await db.getMonthlySummary(this.currentYear, this.currentMonth);
                
                const progressPercentage = summary.progressPercentage;
                const remainingPercentage = Math.max(0, 100 - progressPercentage);

                if (this.progressChart) {
                    this.progressChart.destroy();
                }

                this.progressChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Realizado', 'Restante'],
                        datasets: [{
                            data: [progressPercentage, remainingPercentage],
                            backgroundColor: [
                                progressPercentage >= 100 ? '#10b981' : '#3b82f6',
                                '#e5e7eb'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            async updateSalesChart() {
                const ctx = document.getElementById('sales-chart');
                if (!ctx) return;

                const sales = await db.getSales({ year: this.currentYear, month: this.currentMonth });
                
                // Group by day
                const dailyData = {};
                sales.forEach(sale => {
                    const day = new Date(sale.sale_date).getDate();
                    if (!dailyData[day]) {
                        dailyData[day] = { sales: 0, returns: 0 };
                    }
                    
                    if (sale.sale_type === 'sale') {
                        dailyData[day].sales += sale.amount;
                    } else {
                        dailyData[day].returns += sale.amount;
                    }
                });

                const daysInMonth = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
                const labels = [];
                const salesData = [];
                const returnsData = [];
                const netData = [];

                for (let day = 1; day <= daysInMonth; day++) {
                    labels.push(day);
                    const dayData = dailyData[day] || { sales: 0, returns: 0 };
                    salesData.push(dayData.sales);
                    returnsData.push(dayData.returns);
                    netData.push(dayData.sales - dayData.returns);
                }

                if (this.salesChart) {
                    this.salesChart.destroy();
                }

                this.salesChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Vendas',
                                data: salesData,
                                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1
                            },
                            {
                                label: 'Devolu√ß√µes',
                                data: returnsData,
                                backgroundColor: 'rgba(239, 68, 68, 0.7)',
                                borderColor: 'rgb(239, 68, 68)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            async loadGoalData() {
                const goal = await db.getMonthlyGoal(this.currentYear, this.currentMonth);
                const goalInput = document.getElementById('monthly-goal-input');
                const workdaysInput = document.getElementById('workdays-input');
                
                if (goalInput && workdaysInput) {
                    goalInput.value = goal ? goal.goal_amount : '';
                    workdaysInput.value = goal ? goal.workdays : 22;
                }
            }

            async loadNotesData() {
                const notes = await db.getMonthlyNotes(this.currentYear, this.currentMonth);
                const notesInput = document.getElementById('monthly-notes');
                
                if (notesInput) {
                    notesInput.value = notes ? notes.notes : '';
                }
            }

            async saveMonthlyGoal() {
                const goalAmount = parseFloat(document.getElementById('monthly-goal-input').value);
                const workdays = parseInt(document.getElementById('workdays-input').value);

                if (isNaN(goalAmount) || goalAmount < 0 || isNaN(workdays) || workdays < 1 || workdays > 31) {
                    this.showAlert('Por favor, insira valores v√°lidos para a meta e dias √∫teis.', 'error');
                    return;
                }

                try {
                    await db.saveMonthlyGoal(this.currentYear, this.currentMonth, {
                        goal_amount: goalAmount,
                        workdays: workdays
                    });

                    this.showAlert('Meta salva com sucesso!', 'success');
                    this.updateDisplay();

                } catch (error) {
                    this.showAlert('Erro ao salvar meta: ' + error.message, 'error');
                }
            }

            async saveMonthlyNotes() {
                const notes = document.getElementById('monthly-notes').value;

                try {
                    await db.saveMonthlyNotes(this.currentYear, this.currentMonth, notes);
                    this.showAlert('Anota√ß√µes salvas com sucesso!', 'success');
                } catch (error) {
                    this.showAlert('Erro ao salvar anota√ß√µes: ' + error.message, 'error');
                }
            }

            updateElement(elementId, value) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = `R$ ${this.formatCurrency(value)}`;
                }
            }

            setCurrentDate() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                
                const dateInput = document.getElementById('sale-date');
                if (dateInput) {
                    dateInput.value = `${year}-${month}-${day}`;
                }
            }

            formatCurrency(value) {
                return new Intl.NumberFormat('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(value);
            }

            showAlert(message, type = 'info') {
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                alert.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 9999;
                    padding: 12px 20px;
                    border-radius: 5px;
                    color: white;
                    font-weight: 500;
                    ${type === 'success' ? 'background: #10b981;' : ''}
                    ${type === 'error' ? 'background: #ef4444;' : ''}
                    ${type === 'info' ? 'background: #3b82f6;' : ''}
                `;

                document.body.appendChild(alert);

                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }
        }

        // Global app instance
        const app = new SalesSystemApp();
    </script>

    <!-- === FUN√á√ïES GLOBAIS DE UI === -->
    <script>
        // UI Functions
        function showLogin() {
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('register-modal').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('register-modal').classList.remove('hidden');
            document.getElementById('login-modal').classList.add('hidden');
        }

        function hideModals() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('register-modal').classList.add('hidden');
        }

        function showMainApp() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const company = JSON.parse(localStorage.getItem('currentCompany') || '{}');
            
            document.getElementById('company-name').textContent = company.name || 'Empresa';
            document.getElementById('user-name').textContent = user.name || 'Usu√°rio';

            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Initialize app display
            app.updateDisplay();
        }

        function logout() {
            auth.logout();
        }

        function navigateTo(page) {
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeItem = document.querySelector(`[data-page="${page}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }

            // Show target page
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            const targetPage = document.getElementById(`${page}-page`);
            if (targetPage) {
                targetPage.classList.add('active');
            }
        }

        function printReport() {
            window.print();
        }

        async function exportData() {
            try {
                const data = await db.exportData();
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup-vendas-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                app.showAlert('Backup exportado com sucesso!', 'success');
            } catch (error) {
                app.showAlert('Erro ao exportar backup: ' + error.message, 'error');
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso substituir√° todos os seus dados atuais. Deseja continuar?')) {
                    return;
                }

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const data = JSON.parse(e.target.result);
                        await db.importData(data);
                        app.showAlert('Dados importados com sucesso!', 'success');
                        app.updateDisplay();
                    };
                    reader.readAsText(file);
                } catch (error) {
                    app.showAlert('Erro ao importar dados: ' + error.message, 'error');
                }
            };
            input.click();
        }

        function showStats() {
            alert('Funcionalidade de estat√≠sticas em desenvolvimento!');
        }

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (auth.isLoggedIn()) {
                showMainApp();
            }
        });
    </script>
</body>
</html>